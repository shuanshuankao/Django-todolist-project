{% extends "base.html" %}

{% block title %}
<title>代辦事項</title>
{% endblock %}
{% block css %}
{% endblock %}


{% block content %}


<h1>TodoList</h1>
{% if not todos %}
<h2>無代辦事項，請先新增或登入</h2>
{% endif %}

<div id="todo-list">

</div>



{% for todo in todos %}
<div class="todo">
    <a href="{% url 'delete-todo' todo.id %}" onclick="return confirm('是否刪除?')">刪除</a>
    <h5>{{todo.created}}</h5>
    <a href="{% url 'viewtodo' todo.id %}">
        <h2>{{todo.title}}</h2>
    </a>
    <p>{{todo.text}}</p>
    <u>{{todo.important}}</u>
    {% if todo.date_completed %}
    <p>
        完成時間: <u>{{todo.date_completed}}</u>
    </p>
    {% endif %}
</div>
{% endfor %}

{% endblock %}

{% block javascript %}
<script>
    const listDiv = document.querySelector("#todo-list");
    console.log("listDiv");

    async function getTodoList() {
        // 呼叫api
        const response = await fetch("/api/todos/");
        console.log(response);

        if (!response.ok) {
            alert("取得資料失敗!");
            return;
        }

        const todos = await response.json();
        console.log(todos);

        listDiv.innerHTML = "";
        // todos.forEach((todo) => {
        //     console.log(todo);
        //     const li = document.createElement("li");
        //     li.textContent = ˋ${ todo.title } -${ todo.text } ˋ;
        //     listDiv.appendChild(li);
        // });
    }

    getTodoList()

</script>
{% endblock %}